package obopentest_task

import (
	"errors"
	"github.com/gin-gonic/gin"
	log "k8s.io/klog/v2"
	"net/http"
	"ob-open-test/obopentest-web/model"
)

type TaskController struct {
}

func (tc *TaskController) Add(r *gin.Context) {
	data := Task{}
	if err := r.BindJSON(&data); err != nil {
		r.JSON(http.StatusBadRequest, model.NewHttpInputErrorReply(err))
		log.Warning(err)
		return
	}
	if data.Name == "" {
		r.JSON(http.StatusBadRequest, model.NewHttpInputErrorReply(errors.New("name can't nil")))
		log.Warning("name is nil")
		return
	}
	if err := data.Start(); err != nil {
		r.JSON(http.StatusInternalServerError, model.NewHttpInputErrorReply(err))
		log.Warning("name is nil")
		return
	}
	r.JSON(http.StatusOK, model.NewHttpSuccessReply("Add "+data.Name+" success.Please wait two minutes!"))

}
